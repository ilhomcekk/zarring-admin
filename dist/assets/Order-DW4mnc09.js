import{j as s,r as p,B as D,o as js,u as ts}from"./index-eW-6yITB.js";import{a as M,c as Y}from"./index.es-1QyywiA-.js";import{B as G,c as is,s as us,b as ps,d as gs,e as fs}from"./auth-CBhP_LvO.js";import{C as m,a as ss,b as es,c as rs,d as xs}from"./CModalTitle-BP5unADw.js";import{C as V,a as j}from"./CRow-3m-4mWST.js";import{C as I,a as Cs,b as bs}from"./DefaultLayout-Bz4MAgCX.js";import{C as z,a as Z}from"./CListGroupItem-C4lvdBoO.js";import{o as J}from"./order-DMswF3t1.js";import{p as cs}from"./products-B128YKWP.js";import{i as U}from"./utils-CcWWTO7j.js";import{C as ns,a as ls,b as k,c as a,d as Q,e as x}from"./CTable-iU6qPHck.js";import{C as T}from"./CFormInput-L99v4CEH.js";import{C as ds}from"./CFormSelect-ymNHTX0_.js";import{R as Ss}from"./index-ipilaper.js";import{P as vs}from"./PageLoading-DYCMGmXg.js";import{C as Ps}from"./CPopover-B52llp3c.js";import{c as _s,a as ys}from"./cil-trash-DqRniO5f.js";import{C as ws,a as os}from"./CPaginationItem-Dxu5LM3y.js";import{c as Ns}from"./cil-arrow-left-D66Kb3Zq.js";import{c as ks}from"./cil-arrow-right-CuetXaPY.js";import{C as Ls}from"./CCard-Czglc9r9.js";import{C as Is}from"./CCardHeader-CzZi6ULY.js";import{C as Ms}from"./CCardTitle-B-C91L6L.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-Dxe1bfDj.js";import"./CFormControlValidation-LxJhmD-X.js";import"./CFormLabel-cQNBQ_G2.js";import"./getRTLPlacement-Cwl9A_xm.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";const Es=({visible:u,onClose:i,item:c})=>s.jsxs(m,{size:"xl",visible:u,onClose:i,backdrop:"static",children:[s.jsx(ss,{children:s.jsxs(es,{children:["Баннер ( ",c==null?void 0:c.id," )"]})}),s.jsx(rs,{children:s.jsxs(V,{xs:{gutter:2},children:[s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Имя"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(Z,{className:"p-2",children:c==null?void 0:c.title_ru})})}),s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Картинка"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(Z,{className:"p-2",children:s.jsx("img",{src:G+(c==null?void 0:c.img),height:200,alt:""})})})}),s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Время"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(Z,{className:"p-2",children:c==null?void 0:c.created_at})})})]})})]}),zs={stateProducts:[]},W=is((u,i)=>({...zs,setProducts:c=>{u({stateProducts:c||[]})},toggleProduct:c=>{var l;const g=((l=i())==null?void 0:l.stateProducts)||[];if(g==null?void 0:g.find(o=>(o==null?void 0:o.id)===(c==null?void 0:c.id))){const o=g==null?void 0:g.filter(t=>(t==null?void 0:t.id)!==(c==null?void 0:c.id));i().setProducts(o)}else{c.count=1;const o=[...g,c];i().setProducts(o)}},setCount:(c,g)=>{var t;const v=((t=i())==null?void 0:t.stateProducts)||[],l=v==null?void 0:v.find(N=>(N==null?void 0:N.id)===(c==null?void 0:c.id));l.count=g;const o=[...v];i().setProducts(o)},clearProducts:()=>{u({stateProducts:[]})}})),hs=({visible:u,onClose:i})=>{J();const{stateProducts:c,toggleProduct:g,setCount:v}=W();return console.log(c),cs(),p.useState({user_name:"",user_number:"",status:0,products:[]}),p.useState({page:1,pageSize:20,code:null}),s.jsxs(m,{size:"xl",visible:u,onClose:i,backdrop:"static",children:[s.jsx(ss,{children:s.jsx(es,{children:"Товары"})}),s.jsx(rs,{children:s.jsx(V,{xs:{gutter:2},children:s.jsx(j,{xs:{span:12},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(ns,{striped:!0,children:[s.jsx(ls,{children:s.jsxs(k,{children:[s.jsx(a,{scope:"col",children:"ИД"}),s.jsx(a,{scope:"col",children:"Имя"}),s.jsx(a,{scope:"col",children:"Количество"}),s.jsx(a,{scope:"col",children:"Картинка"}),s.jsx(a,{scope:"col",children:"Код"}),s.jsx(a,{scope:"col",children:"Сумма"}),s.jsx(a,{scope:"col"})]})}),s.jsx(Q,{children:c==null?void 0:c.map((l,o)=>s.jsxs(k,{children:[s.jsx(a,{scope:"row",children:l==null?void 0:l.id}),s.jsx(x,{children:l==null?void 0:l.title}),s.jsx(x,{children:s.jsx(T,{placeholder:"Количество",value:l==null?void 0:l.count,onChange:t=>v(l,+t.target.value),type:"number"})}),s.jsx(x,{children:s.jsx("img",{src:G+(l==null?void 0:l.img),width:50,height:50,alt:""})}),s.jsx(x,{children:l==null?void 0:l.code}),s.jsx(x,{children:l==null?void 0:l.price}),s.jsx(x,{children:s.jsx(M,{color:`${U(c,l==null?void 0:l.id)?"danger":"primary"}`,onClick:()=>g(l),children:U(c,l==null?void 0:l.id)?"Удалить":"Добавить"})})]},o))})]})})})})}),s.jsx(xs,{children:s.jsx(M,{color:"danger",onClick:i,children:"Закрыть"})})]})},Ts=({visible:u,onClose:i,id:c})=>{var _,E,q;const[g,v]=p.useState(!1),{setProducts:l,stateProducts:o,toggleProduct:t}=W(),{productCodes:N,getList:$,list:P,clearList:y}=cs(),{detail:h,getDetail:A,getList:C,edit:O,editLoading:B}=J(),[f,R]=p.useState({user_name:"",user_number:"",status:0,products:o||[]}),[F,H]=p.useState({page:1,pageSize:20,code:null}),d=(e,L)=>{H({...f,[e]:L})},w=e=>{const{name:L,value:X}=e.target;R({...f,[L]:X})};p.useEffect(()=>{R(e=>({...e,products:o}))},[o]),p.useEffect(()=>{u&&(A(c),y())},[u]),p.useEffect(()=>{R({user_name:h==null?void 0:h.user_name,user_number:h==null?void 0:h.user_number,status:h==null?void 0:h.status}),l((h==null?void 0:h.products)||[])},[h]);const n=()=>{O(c,f).then(e=>{console.log(e,"asdasdas"),e!=null&&e.data&&(D.success("Успешно"),C({page:1,pageSize:20}),i())}).catch(e=>console.log("err",e))};return s.jsxs(s.Fragment,{children:[s.jsxs(m,{size:"xl",visible:u,onClose:i,backdrop:"static",children:[s.jsx(ss,{children:s.jsxs(es,{children:["Заказ № ( ",h==null?void 0:h.id," )"]})}),s.jsx(rs,{children:s.jsxs(V,{xs:{gutter:2},children:[s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Имя заказчика"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(T,{name:"user_name",onChange:w,value:f==null?void 0:f.user_name})})}),s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Номер заказчика"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(T,{name:"user_number",onChange:w,value:f==null?void 0:f.user_number})})}),s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Статус заказа"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(ds,{name:"status",className:"w-50",value:f==null?void 0:f.status,onChange:w,options:(_=us)==null?void 0:_.map(e=>({label:e==null?void 0:e.name,value:e==null?void 0:e.value})),style:{background:ps(Number(f==null?void 0:f.status))}})})}),s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Время"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(Z,{className:"p-2",children:h==null?void 0:h.created_at})})}),s.jsx(j,{xs:{span:12},onClick:()=>v(!0),children:s.jsxs(I,{className:"p-2 m-0",color:"primary",children:["Товары ( ",o==null?void 0:o.length," )"]})}),s.jsx(j,{xs:{span:12},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(ns,{striped:!0,children:[s.jsxs(ls,{children:[s.jsxs(k,{children:[s.jsx(a,{scope:"col",children:"ИД"}),s.jsx(a,{scope:"col",children:"Картинка"}),s.jsx(a,{scope:"col",children:"Имя"}),s.jsx(a,{scope:"col",children:"Количество"}),s.jsx(a,{scope:"col",children:"Код"}),s.jsx(a,{scope:"col",children:"Сумма"}),s.jsx(a,{scope:"col"})]}),s.jsx(k,{children:s.jsx(a,{scope:"col",children:s.jsx(ds,{name:"code",value:F==null?void 0:F.code,onChange:e=>{d("code",e.target.value),$({page:1,pageSize:20,code:e.target.value||null})},options:["",...N==null?void 0:N.map(e=>({label:e==null?void 0:e.code,value:e==null?void 0:e.code}))]})})})]}),((E=P==null?void 0:P.data)==null?void 0:E.length)>0&&"Поиск по коду",s.jsx(Q,{children:(q=P==null?void 0:P.data)==null?void 0:q.map((e,L)=>s.jsxs(k,{children:[s.jsx(a,{scope:"row",children:e==null?void 0:e.id}),s.jsx(x,{children:e==null?void 0:e.title}),s.jsx(x,{children:s.jsx("img",{src:G+(e==null?void 0:e.img),width:50,height:50,alt:""})}),s.jsx(x,{children:e==null?void 0:e.count}),s.jsx(x,{children:e==null?void 0:e.code}),s.jsx(x,{children:e==null?void 0:e.price}),s.jsx(x,{children:s.jsx(M,{color:`${U(o,e==null?void 0:e.id)?"danger":"primary"}`,onClick:()=>t(e),children:U(o,e==null?void 0:e.id)?"Удалить":"Добавить"})})]},L))}),(o==null?void 0:o.length)>0&&"Ваши товары",s.jsx(Q,{children:o==null?void 0:o.map((e,L)=>s.jsxs(k,{children:[s.jsx(a,{scope:"row",children:e==null?void 0:e.id}),s.jsx(x,{children:e==null?void 0:e.title}),s.jsx(x,{children:s.jsx("img",{src:G+(e==null?void 0:e.img),width:50,height:50,alt:""})}),s.jsx(x,{children:e==null?void 0:e.count}),s.jsx(x,{children:e==null?void 0:e.code}),s.jsx(x,{children:e==null?void 0:e.price})]},L))})]})})})]})}),s.jsx(xs,{children:s.jsx(M,{color:"primary",onClick:n,children:"Сохранить"})})]}),s.jsx(hs,{visible:g,onClose:()=>v(!1)})]})},Os=()=>{var X;const u=js(),{search:i}=ts(),c=new URLSearchParams(i),g=c.get("status"),v=c.get("id"),l=c.get("user_name"),o=c.get("user_number"),t=c.get("from_to"),N=c.get("page"),$=c.get("pageSize"),{getList:P,list:y,remove:h,deleteLoading:A,listLoading:C}=J(),{clearProducts:O}=W(),{getProductCodes:B}=cs(),[f,R]=p.useState({}),[F,H]=p.useState(null),[d,w]=p.useState({page:N,pageSize:$,status:g,id:v,user_name:l,user_number:o,from_to:t}),[n,_]=p.useState(!1),[E,q]=p.useState(!1),e=(r,b)=>{w(S=>({...S,page:1,[r]:b||null}))},L=r=>{if(r.key==="Enter"){const b=Object.fromEntries(Object.entries(d).filter(([K,as])=>as!=null)),S=new URLSearchParams(b).toString();u(`?${S}`)}};return p.useEffect(()=>{const r={page:N,pageSize:$,status:g,id:v,user_name:l,user_number:o,from_to:t};w(r),P(r),B()},[i]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(ns,{striped:!0,children:[s.jsxs(ls,{children:[s.jsxs(k,{children:[s.jsx(a,{scope:"col",children:"ИД"}),s.jsx(a,{scope:"col",children:"Имя заказчика"}),s.jsx(a,{scope:"col",children:"Номер заказчика"}),s.jsx(a,{scope:"col",children:"Статус заказа"}),s.jsx(a,{scope:"col",children:"Время"}),s.jsx(a,{scope:"col"})]}),s.jsxs(k,{children:[s.jsx(a,{scope:"col",children:s.jsx(T,{type:"text",value:d==null?void 0:d.id,onChange:r=>e("id",r.target.value),onKeyPress:L})}),s.jsx(a,{scope:"col",children:s.jsx(T,{type:"text",value:d==null?void 0:d.user_name,onChange:r=>e("user_name",r.target.value),onKeyPress:L})}),s.jsx(a,{scope:"col",children:s.jsx(T,{type:"text",value:d==null?void 0:d.user_number,onChange:r=>e("user_number",r.target.value),onKeyPress:L})}),s.jsx(a,{scope:"col"}),s.jsx(a,{scope:"col",children:s.jsxs("div",{className:`${(d==null?void 0:d.from_to)&&"date-active"}`,children:[s.jsx(Ss,{onDateSelected:(r,b)=>{const S=Math.floor(new Date(r).getTime()/1e3),K=Math.floor(new Date(b).getTime()/1e3);e("from_to",`${S}-${K}`)},onClose:()=>{const r=Object.fromEntries(Object.entries(d).filter(([S,K])=>K!=null)),b=new URLSearchParams(r).toString();u(`?${b}`)}}),(d==null?void 0:d.from_to)&&s.jsx(Cs,{className:"ms-2",onClick:()=>{const r={...d};r.from_to=null,w(r);const b=Object.fromEntries(Object.entries(r).filter(([K,as])=>as!=null)),S=new URLSearchParams(b).toString();u(`?${S}`)}})]})})]})]}),s.jsxs(Q,{children:[(X=y==null?void 0:y.orders)==null?void 0:X.map((r,b)=>s.jsxs(k,{children:[s.jsx(a,{scope:"row",children:r==null?void 0:r.id}),s.jsx(x,{children:r==null?void 0:r.user_name}),s.jsx(x,{children:r==null?void 0:r.user_number}),s.jsx(x,{children:s.jsx(bs,{size:"lg",className:"p-2",color:gs(r==null?void 0:r.status),children:fs(r==null?void 0:r.status)})}),s.jsx(x,{children:r==null?void 0:r.createdAt}),s.jsx(x,{children:s.jsxs("div",{className:"d-flex",children:[s.jsx(Ps,{title:r==null?void 0:r.id,trigger:"focus",content:s.jsxs("div",{children:[s.jsx("div",{children:"Вы точно хотите удалить?"}),s.jsx(M,{disabled:A,onClick:()=>h(r==null?void 0:r.id).then(S=>{S!=null&&S.data&&D.success("Успешно удалено")}),color:"danger",className:"mt-2",children:"Удалить"})]}),children:s.jsx(M,{className:"mx-2",color:"danger",children:s.jsx(Y,{icon:_s})})}),s.jsx(M,{color:"warning",onClick:()=>{H(r==null?void 0:r.id),q(!0)},children:s.jsx(Y,{icon:ys})})]})})]},b)),s.jsxs(ws,{children:[s.jsx(os,{onClick:()=>{const r={...d};r.page-=1,w(r),P(r)},disabled:d.page===1,children:s.jsx(Y,{icon:Ns})}),[...Array(y==null?void 0:y.totalPages)].map((r,b)=>s.jsx(os,{onClick:()=>{const S={...d};S.page=b+1,w(S),P(S)},active:d.page===b+1,children:b+1},b)),s.jsx(os,{onClick:()=>{const r={...d};r.page+=1,w(r),P(r)},disabled:d.page===(y==null?void 0:y.totalPages),children:s.jsx(Y,{icon:ks})})]})]})]})}),s.jsx(Es,{visible:n,onClose:()=>_(!1),item:f}),s.jsx(Ts,{visible:E,onClose:()=>{q(!1),O()},id:F}),s.jsx(vs,{loading:C})]})},Rs=({visible:u,onClose:i})=>{var w;const[c,g]=p.useState(!1),{create:v,createLoading:l}=J(),{getList:o}=J(),{stateProducts:t,toggleProduct:N,clearProducts:$}=W();console.log(t);const{productCodes:P,getList:y,list:h,clearList:A}=cs(),[C,O]=p.useState({user_name:"",user_number:"",products:t}),[B,f]=p.useState({page:1,pageSize:20,code:null}),R=n=>{const{name:_,value:E}=n.target;O({...C,[_]:E})},F=(n,_)=>{f({...C,[n]:_})},H=()=>{O({user_name:"",user_number:"",products:t})};p.useEffect(()=>{O(n=>({...n,products:t}))},[t]);const d=()=>{var n;C.user_name?C.user_number?((n=C.products)==null?void 0:n.length)<1?D.error("Добавьте товар"):v(C).then(_=>{var E;(E=_==null?void 0:_.data)!=null&&E.id&&(D.success("Заказ успешно добавлено"),i(),$(),o(),H())}):D.error("Заполните номер телефона"):D.error("Заполните имя")};return p.useEffect(()=>{u&&A()},[u]),s.jsxs(s.Fragment,{children:[s.jsxs(m,{size:"xl",visible:u,onClose:i,backdrop:"static",children:[s.jsx(ss,{children:s.jsx(es,{children:"Создать заказ"})}),s.jsx(rs,{children:s.jsxs(V,{xs:{gutter:2},children:[s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Имя заказчика"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(T,{name:"user_name",onChange:R,value:C==null?void 0:C.user_name})})}),s.jsx(j,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Номер заказчика"})}),s.jsx(j,{xs:{span:6},children:s.jsx(z,{children:s.jsx(T,{name:"user_number",onChange:R,value:C==null?void 0:C.user_number})})}),s.jsx(j,{xs:{span:12},onClick:()=>g(!0),children:s.jsxs(I,{className:"p-2 m-0",color:"primary",children:["Товары ( ",t==null?void 0:t.length," )"]})}),s.jsx(j,{xs:{span:12},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(ns,{striped:!0,children:[s.jsxs(ls,{children:[s.jsxs(k,{children:[s.jsx(a,{scope:"col",children:"ИД"}),s.jsx(a,{scope:"col",children:"Имя"}),s.jsx(a,{scope:"col",children:"Картинка"}),s.jsx(a,{scope:"col",children:"Код"}),s.jsx(a,{scope:"col",children:"Сумма"}),s.jsx(a,{scope:"col"})]}),s.jsx(k,{children:s.jsx(a,{scope:"col",children:s.jsx(ds,{name:"code",value:B==null?void 0:B.code,onChange:n=>{F("code",n.target.value),y({page:1,pageSize:20,code:n.target.value||null})},options:["",...P==null?void 0:P.map(n=>({label:n==null?void 0:n.code,value:n==null?void 0:n.code}))]})})})]}),s.jsx(Q,{children:(w=h==null?void 0:h.data)==null?void 0:w.map((n,_)=>s.jsxs(k,{children:[s.jsx(a,{scope:"row",children:n==null?void 0:n.id}),s.jsx(x,{children:n==null?void 0:n.title}),s.jsx(x,{children:s.jsx("img",{src:G+(n==null?void 0:n.img),width:50,height:50,alt:""})}),s.jsx(x,{children:n==null?void 0:n.code}),s.jsx(x,{children:n==null?void 0:n.price}),s.jsx(x,{children:s.jsx(M,{color:`${U(t,n==null?void 0:n.id)?"danger":"primary"}`,onClick:()=>N(n),children:U(t,n==null?void 0:n.id)?"Удалить":"Добавить"})})]},_))})]})})})]})}),s.jsx(xs,{children:s.jsx(M,{color:"primary",disabled:l,onClick:d,children:l?"Загрузка":"Сохранить"})})]}),s.jsx(hs,{visible:c,onClose:()=>g(!1)})]})},je=()=>{const{clearProducts:u}=W(),[i,c]=p.useState(!1);return s.jsxs(s.Fragment,{children:[s.jsxs(Ls,{children:[s.jsx(Is,{children:s.jsxs(V,{children:[s.jsx(j,{className:"d-flex align-items-center",children:s.jsx(Ms,{className:"mb-0",children:"Заказы"})}),s.jsx(j,{className:"d-flex justify-content-end",children:s.jsx(M,{color:"primary",onClick:()=>c(!0),children:"Создать"})})]})}),s.jsx(Os,{})]}),s.jsx(Rs,{visible:i,onClose:()=>{c(!1),u()}})]})};export{je as default};
