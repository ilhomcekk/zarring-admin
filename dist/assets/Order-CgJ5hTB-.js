import{j as s,r as p,B as q,o as js,u as ts}from"./index-DVCylq0Q.js";import{a as T,c as as}from"./index.es-D1a6A4w_.js";import{B as K,c as us,s as is,b as ps,d as gs,e as fs}from"./auth-COeWrjcC.js";import{C as Z,a as m,b as ss,c as es,d as xs}from"./CModalTitle-DGooZh2_.js";import{C as Q,a as h}from"./CRow-DsUHbXhC.js";import{C as I,a as Cs,b as bs}from"./DefaultLayout-DZ7uc0CW.js";import{C as E,a as Y}from"./CListGroupItem-C5LCyosc.js";import{o as G}from"./order-CGKwTtM4.js";import{p as rs}from"./products-p-isSOdL.js";import{i as D}from"./utils-jGJlRVFu.js";import{C as cs,a as ns,b as k,c as l,d as J,e as x}from"./CTable-_oTpxpYH.js";import{C as z}from"./CFormInput-DSAYN9JZ.js";import{C as ds}from"./CFormSelect-DMkWeAo9.js";import{R as Ss}from"./index-BykZOzjs.js";import{P as _s}from"./PageLoading-BzyQkLAF.js";import{c as Ps}from"./cil-pen-53d2I-C-.js";import{C as vs,a as os}from"./CPaginationItem-Km6D7boB.js";import{c as ys}from"./cil-arrow-left-D66Kb3Zq.js";import{c as ws}from"./cil-arrow-right-CuetXaPY.js";import{C as Ns}from"./CCard-DsvGdDII.js";import{C as ks}from"./CCardHeader-TZ1QTRXN.js";import{C as Ls}from"./CCardTitle-CXhH0zEy.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-BybLwgQS.js";import"./CFormControlValidation-R1UaZUmp.js";import"./CFormLabel-hzNGrAC8.js";const Is=({visible:i,onClose:u,item:c})=>s.jsxs(Z,{size:"xl",visible:i,onClose:u,backdrop:"static",children:[s.jsx(m,{children:s.jsxs(ss,{children:["Баннер ( ",c==null?void 0:c.id," )"]})}),s.jsx(es,{children:s.jsxs(Q,{xs:{gutter:2},children:[s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Имя"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(Y,{className:"p-2",children:c==null?void 0:c.title_ru})})}),s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Картинка"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(Y,{className:"p-2",children:s.jsx("img",{src:K+(c==null?void 0:c.img),height:200,alt:""})})})}),s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Время"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(Y,{className:"p-2",children:c==null?void 0:c.created_at})})})]})})]}),Ms={stateProducts:[]},V=us((i,u)=>({...Ms,setProducts:c=>{i({stateProducts:c||[]})},toggleProduct:c=>{var a;const g=((a=u())==null?void 0:a.stateProducts)||[];if(g==null?void 0:g.find(o=>(o==null?void 0:o.id)===(c==null?void 0:c.id))){const o=g==null?void 0:g.filter(j=>(j==null?void 0:j.id)!==(c==null?void 0:c.id));u().setProducts(o)}else{c.count=1;const o=[...g,c];u().setProducts(o)}},setCount:(c,g)=>{var j;const S=((j=u())==null?void 0:j.stateProducts)||[],a=S==null?void 0:S.find(N=>(N==null?void 0:N.id)===(c==null?void 0:c.id));a.count=g;const o=[...S];u().setProducts(o)},clearProducts:()=>{i({stateProducts:[]})}})),hs=({visible:i,onClose:u})=>{G();const{stateProducts:c,toggleProduct:g,setCount:S}=V();return console.log(c),rs(),p.useState({user_name:"",user_number:"",status:0,products:[]}),p.useState({page:1,pageSize:20,code:null}),s.jsxs(Z,{size:"xl",visible:i,onClose:u,backdrop:"static",children:[s.jsx(m,{children:s.jsx(ss,{children:"Товары"})}),s.jsx(es,{children:s.jsx(Q,{xs:{gutter:2},children:s.jsx(h,{xs:{span:12},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(cs,{striped:!0,children:[s.jsx(ns,{children:s.jsxs(k,{children:[s.jsx(l,{scope:"col",children:"ИД"}),s.jsx(l,{scope:"col",children:"Имя"}),s.jsx(l,{scope:"col",children:"Количество"}),s.jsx(l,{scope:"col",children:"Картинка"}),s.jsx(l,{scope:"col",children:"Код"}),s.jsx(l,{scope:"col",children:"Сумма"}),s.jsx(l,{scope:"col"})]})}),s.jsx(J,{children:c==null?void 0:c.map((a,o)=>s.jsxs(k,{children:[s.jsx(l,{scope:"row",children:a==null?void 0:a.id}),s.jsx(x,{children:a==null?void 0:a.title}),s.jsx(x,{children:s.jsx(z,{placeholder:"Количество",value:a==null?void 0:a.count,onChange:j=>S(a,+j.target.value),type:"number"})}),s.jsx(x,{children:s.jsx("img",{src:K+(a==null?void 0:a.img),width:50,height:50,alt:""})}),s.jsx(x,{children:a==null?void 0:a.code}),s.jsx(x,{children:a==null?void 0:a.price}),s.jsx(x,{children:s.jsx(T,{color:`${D(c,a==null?void 0:a.id)?"danger":"primary"}`,onClick:()=>g(a),children:D(c,a==null?void 0:a.id)?"Удалить":"Добавить"})})]},o))})]})})})})}),s.jsx(xs,{children:s.jsx(T,{color:"danger",onClick:u,children:"Закрыть"})})]})},Es=({visible:i,onClose:u,id:c})=>{var v,M,A;const[g,S]=p.useState(!1),{setProducts:a,stateProducts:o,toggleProduct:j}=V(),{productCodes:N,getList:$,list:_,clearList:y}=rs(),{detail:t,getDetail:W,getList:C,edit:O,editLoading:B}=G(),[f,R]=p.useState({user_name:"",user_number:"",status:0,products:o||[]}),[F,U]=p.useState({page:1,pageSize:20,code:null}),d=(e,L)=>{U({...f,[e]:L})},w=e=>{const{name:L,value:X}=e.target;R({...f,[L]:X})};p.useEffect(()=>{R(e=>({...e,products:o}))},[o]),p.useEffect(()=>{i&&(W(c),y())},[i]),p.useEffect(()=>{R({user_name:t==null?void 0:t.user_name,user_number:t==null?void 0:t.user_number,status:t==null?void 0:t.status}),a((t==null?void 0:t.products)||[])},[t]);const n=()=>{O(c,f).then(e=>{console.log(e,"asdasdas"),e!=null&&e.data&&(q.success("Успешно"),C({page:1,pageSize:20}),u())}).catch(e=>console.log("err",e))};return s.jsxs(s.Fragment,{children:[s.jsxs(Z,{size:"xl",visible:i,onClose:u,backdrop:"static",children:[s.jsx(m,{children:s.jsxs(ss,{children:["Заказ № ( ",t==null?void 0:t.id," )"]})}),s.jsx(es,{children:s.jsxs(Q,{xs:{gutter:2},children:[s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Имя заказчика"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(z,{name:"user_name",onChange:w,value:f==null?void 0:f.user_name})})}),s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Номер заказчика"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(z,{name:"user_number",onChange:w,value:f==null?void 0:f.user_number})})}),s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Статус заказа"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(ds,{name:"status",className:"w-50",value:f==null?void 0:f.status,onChange:w,options:(v=is)==null?void 0:v.map(e=>({label:e==null?void 0:e.name,value:e==null?void 0:e.value})),style:{background:ps(Number(f==null?void 0:f.status))}})})}),s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Время"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(Y,{className:"p-2",children:t==null?void 0:t.created_at})})}),s.jsx(h,{xs:{span:12},onClick:()=>S(!0),children:s.jsxs(I,{className:"p-2 m-0",color:"primary",children:["Товары ( ",o==null?void 0:o.length," )"]})}),s.jsx(h,{xs:{span:12},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(cs,{striped:!0,children:[s.jsxs(ns,{children:[s.jsxs(k,{children:[s.jsx(l,{scope:"col",children:"ИД"}),s.jsx(l,{scope:"col",children:"Картинка"}),s.jsx(l,{scope:"col",children:"Имя"}),s.jsx(l,{scope:"col",children:"Количество"}),s.jsx(l,{scope:"col",children:"Код"}),s.jsx(l,{scope:"col",children:"Сумма"}),s.jsx(l,{scope:"col"})]}),s.jsx(k,{children:s.jsx(l,{scope:"col",children:s.jsx(ds,{name:"code",value:F==null?void 0:F.code,onChange:e=>{d("code",e.target.value),$({page:1,pageSize:20,code:e.target.value||null})},options:["",...N==null?void 0:N.map(e=>({label:e==null?void 0:e.code,value:e==null?void 0:e.code}))]})})})]}),((M=_==null?void 0:_.data)==null?void 0:M.length)>0&&"Поиск по коду",s.jsx(J,{children:(A=_==null?void 0:_.data)==null?void 0:A.map((e,L)=>s.jsxs(k,{children:[s.jsx(l,{scope:"row",children:e==null?void 0:e.id}),s.jsx(x,{children:e==null?void 0:e.title}),s.jsx(x,{children:s.jsx("img",{src:K+(e==null?void 0:e.img),width:50,height:50,alt:""})}),s.jsx(x,{children:e==null?void 0:e.count}),s.jsx(x,{children:e==null?void 0:e.code}),s.jsx(x,{children:e==null?void 0:e.price}),s.jsx(x,{children:s.jsx(T,{color:`${D(o,e==null?void 0:e.id)?"danger":"primary"}`,onClick:()=>j(e),children:D(o,e==null?void 0:e.id)?"Удалить":"Добавить"})})]},L))}),(o==null?void 0:o.length)>0&&"Ваши товары",s.jsx(J,{children:o==null?void 0:o.map((e,L)=>s.jsxs(k,{children:[s.jsx(l,{scope:"row",children:e==null?void 0:e.id}),s.jsx(x,{children:e==null?void 0:e.title}),s.jsx(x,{children:s.jsx("img",{src:K+(e==null?void 0:e.img),width:50,height:50,alt:""})}),s.jsx(x,{children:e==null?void 0:e.count}),s.jsx(x,{children:e==null?void 0:e.code}),s.jsx(x,{children:e==null?void 0:e.price})]},L))})]})})})]})}),s.jsx(xs,{children:s.jsx(T,{color:"primary",onClick:n,children:"Сохранить"})})]}),s.jsx(hs,{visible:g,onClose:()=>S(!1)})]})},zs=()=>{var X;const i=js(),{search:u}=ts(),c=new URLSearchParams(u),g=c.get("status"),S=c.get("id"),a=c.get("user_name"),o=c.get("user_number"),j=c.get("from_to"),N=c.get("page"),$=c.get("pageSize"),{getList:_,list:y,remove:t,deleteLoading:W,listLoading:C}=G(),{clearProducts:O}=V(),{getProductCodes:B}=rs(),[f,R]=p.useState({}),[F,U]=p.useState(null),[d,w]=p.useState({page:N,pageSize:$,status:g,id:S,user_name:a,user_number:o,from_to:j}),[n,v]=p.useState(!1),[M,A]=p.useState(!1),e=(r,b)=>{w(P=>({...P,page:1,[r]:b||null}))},L=r=>{if(r.key==="Enter"){const b=Object.fromEntries(Object.entries(d).filter(([H,ls])=>ls!=null)),P=new URLSearchParams(b).toString();i(`?${P}`)}};return p.useEffect(()=>{const r={page:N,pageSize:$,status:g,id:S,user_name:a,user_number:o,from_to:j};w(r),_(r),B()},[u]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(cs,{striped:!0,children:[s.jsxs(ns,{children:[s.jsxs(k,{children:[s.jsx(l,{scope:"col",children:"ИД"}),s.jsx(l,{scope:"col",children:"Имя заказчика"}),s.jsx(l,{scope:"col",children:"Номер заказчика"}),s.jsx(l,{scope:"col",children:"Количество товара"}),s.jsx(l,{scope:"col",children:"Статус заказа"}),s.jsx(l,{scope:"col",children:"Время"}),s.jsx(l,{scope:"col"})]}),s.jsxs(k,{children:[s.jsx(l,{scope:"col",children:s.jsx(z,{type:"text",value:d==null?void 0:d.id,onChange:r=>e("id",r.target.value),onKeyPress:L})}),s.jsx(l,{scope:"col",children:s.jsx(z,{type:"text",value:d==null?void 0:d.user_name,onChange:r=>e("user_name",r.target.value),onKeyPress:L})}),s.jsx(l,{scope:"col",children:s.jsx(z,{type:"text",value:d==null?void 0:d.user_number,onChange:r=>e("user_number",r.target.value),onKeyPress:L})}),s.jsx(l,{scope:"col"}),s.jsx(l,{scope:"col"}),s.jsx(l,{scope:"col",children:s.jsxs("div",{className:`d-flex align-items-center ${(d==null?void 0:d.from_to)&&"date-active"}`,children:[s.jsx(Ss,{onDateSelected:(r,b)=>{const P=Math.floor(new Date(r).getTime()/1e3),H=Math.floor(new Date(b).getTime()/1e3);e("from_to",`${P}-${H}`)},onClose:()=>{const r=Object.fromEntries(Object.entries(d).filter(([P,H])=>H!=null)),b=new URLSearchParams(r).toString();i(`?${b}`)}}),(d==null?void 0:d.from_to)&&s.jsx(Cs,{className:"ms-2",onClick:()=>{const r={...d};r.from_to=null,w(r);const b=Object.fromEntries(Object.entries(r).filter(([H,ls])=>ls!=null)),P=new URLSearchParams(b).toString();i(`?${P}`)}})]})}),s.jsx(l,{scope:"col"})]})]}),s.jsxs(J,{children:[(X=y==null?void 0:y.orders)==null?void 0:X.map((r,b)=>{var P;return s.jsxs(k,{children:[s.jsx(l,{scope:"row",children:r==null?void 0:r.id}),s.jsx(x,{children:r==null?void 0:r.user_name}),s.jsx(x,{children:r==null?void 0:r.user_number}),s.jsx(x,{children:(P=r==null?void 0:r.products)==null?void 0:P.length}),s.jsx(x,{children:s.jsx(bs,{size:"lg",className:"p-2",color:gs(r==null?void 0:r.status),children:fs(r==null?void 0:r.status)})}),s.jsx(x,{children:r==null?void 0:r.createdAt}),s.jsx(x,{children:s.jsx("div",{className:"d-flex",children:s.jsx(T,{color:"warning",onClick:()=>{U(r==null?void 0:r.id),A(!0)},children:s.jsx(as,{icon:Ps})})})})]},b)}),s.jsxs(vs,{children:[s.jsx(os,{onClick:()=>{const r={...d};r.page-=1,w(r),_(r)},disabled:d.page===1,children:s.jsx(as,{icon:ys})}),[...Array(y==null?void 0:y.totalPages)].map((r,b)=>s.jsx(os,{onClick:()=>{const P={...d};P.page=b+1,w(P),_(P)},active:d.page===b+1,children:b+1},b)),s.jsx(os,{onClick:()=>{const r={...d};r.page+=1,w(r),_(r)},disabled:d.page===(y==null?void 0:y.totalPages),children:s.jsx(as,{icon:ws})})]})]})]})}),s.jsx(Is,{visible:n,onClose:()=>v(!1),item:f}),s.jsx(Es,{visible:M,onClose:()=>{A(!1),O()},id:F}),s.jsx(_s,{loading:C})]})},Ts=({visible:i,onClose:u})=>{var w;const[c,g]=p.useState(!1),{create:S,createLoading:a}=G(),{getList:o}=G(),{stateProducts:j,toggleProduct:N,clearProducts:$}=V();console.log(j);const{productCodes:_,getList:y,list:t,clearList:W}=rs(),[C,O]=p.useState({user_name:"",user_number:"",products:j}),[B,f]=p.useState({page:1,pageSize:20,code:null}),R=n=>{const{name:v,value:M}=n.target;O({...C,[v]:M})},F=(n,v)=>{f({...C,[n]:v})},U=()=>{O({user_name:"",user_number:"",products:j})};p.useEffect(()=>{O(n=>({...n,products:j}))},[j]);const d=()=>{var n;C.user_name?C.user_number?((n=C.products)==null?void 0:n.length)<1?q.error("Добавьте товар"):S(C).then(v=>{var M;(M=v==null?void 0:v.data)!=null&&M.id&&(q.success("Заказ успешно добавлено"),u(),$(),o(),U())}):q.error("Заполните номер телефона"):q.error("Заполните имя")};return p.useEffect(()=>{i&&W()},[i]),s.jsxs(s.Fragment,{children:[s.jsxs(Z,{size:"xl",visible:i,onClose:u,backdrop:"static",children:[s.jsx(m,{children:s.jsx(ss,{children:"Создать заказ"})}),s.jsx(es,{children:s.jsxs(Q,{xs:{gutter:2},children:[s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Имя заказчика"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(z,{name:"user_name",onChange:R,value:C==null?void 0:C.user_name})})}),s.jsx(h,{xs:{span:6},children:s.jsx(I,{className:"p-2 m-0",color:"primary",children:"Номер заказчика"})}),s.jsx(h,{xs:{span:6},children:s.jsx(E,{children:s.jsx(z,{name:"user_number",onChange:R,value:C==null?void 0:C.user_number})})}),s.jsx(h,{xs:{span:12},onClick:()=>g(!0),children:s.jsxs(I,{className:"p-2 m-0",color:"primary",children:["Товары ( ",j==null?void 0:j.length," )"]})}),s.jsx(h,{xs:{span:12},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(cs,{striped:!0,children:[s.jsxs(ns,{children:[s.jsxs(k,{children:[s.jsx(l,{scope:"col",children:"ИД"}),s.jsx(l,{scope:"col",children:"Имя"}),s.jsx(l,{scope:"col",children:"Картинка"}),s.jsx(l,{scope:"col",children:"Код"}),s.jsx(l,{scope:"col",children:"Сумма"}),s.jsx(l,{scope:"col"})]}),s.jsx(k,{children:s.jsx(l,{scope:"col",children:s.jsx(ds,{name:"code",value:B==null?void 0:B.code,onChange:n=>{F("code",n.target.value),y({page:1,pageSize:20,code:n.target.value||null})},options:["",..._==null?void 0:_.map(n=>({label:n==null?void 0:n.code,value:n==null?void 0:n.code}))]})})})]}),s.jsx(J,{children:(w=t==null?void 0:t.data)==null?void 0:w.map((n,v)=>s.jsxs(k,{children:[s.jsx(l,{scope:"row",children:n==null?void 0:n.id}),s.jsx(x,{children:n==null?void 0:n.title}),s.jsx(x,{children:s.jsx("img",{src:K+(n==null?void 0:n.img),width:50,height:50,alt:""})}),s.jsx(x,{children:n==null?void 0:n.code}),s.jsx(x,{children:n==null?void 0:n.price}),s.jsx(x,{children:s.jsx(T,{color:`${D(j,n==null?void 0:n.id)?"danger":"primary"}`,onClick:()=>N(n),children:D(j,n==null?void 0:n.id)?"Удалить":"Добавить"})})]},v))})]})})})]})}),s.jsx(xs,{children:s.jsx(T,{color:"primary",disabled:a,onClick:d,children:a?"Загрузка":"Сохранить"})})]}),s.jsx(hs,{visible:c,onClose:()=>g(!1)})]})},ae=()=>{const{clearProducts:i}=V(),[u,c]=p.useState(!1);return s.jsxs(s.Fragment,{children:[s.jsxs(Ns,{children:[s.jsx(ks,{children:s.jsxs(Q,{children:[s.jsx(h,{className:"d-flex align-items-center",children:s.jsx(Ls,{className:"mb-0",children:"Заказы"})}),s.jsx(h,{className:"d-flex justify-content-end",children:s.jsx(T,{color:"primary",onClick:()=>c(!0),children:"Создать"})})]})}),s.jsx(zs,{})]}),s.jsx(Ts,{visible:u,onClose:()=>{c(!1),i()}})]})};export{ae as default};
