import{j as e,r as S,B as Y}from"./index-eW-6yITB.js";import{a as C,c as R}from"./index.es-1QyywiA-.js";import{B as J}from"./auth-CBhP_LvO.js";import{C as ee,a as le,b as ae,c as se,d as ne}from"./CModalTitle-BP5unADw.js";import{C as ie,a as P}from"./CRow-3m-4mWST.js";import{C as Z}from"./DefaultLayout-Bz4MAgCX.js";import{C as B,a as V}from"./CListGroupItem-C4lvdBoO.js";import{p as re}from"./products-B128YKWP.js";import{c as ce}from"./category-Cp1qaDYF.js";import{f as he}from"./utils-CcWWTO7j.js";import{C as g}from"./CFormInput-L99v4CEH.js";import{C as F}from"./CFormSelect-ymNHTX0_.js";import{C as oe}from"./CInputGroupText-CgCLvPKS.js";import{C as $}from"./CInputGroup-Cy2E_5hF.js";import{c as K,a as xe}from"./cil-trash-DqRniO5f.js";import{C as O}from"./CFormTextarea-DMiUNMjC.js";import{C as te}from"./CForm-CtjPMG9S.js";import{C as de}from"./CFormLabel-cQNBQ_G2.js";import{U as pe}from"./index-Vi-98Njc.js";import{R as ge}from"./index-ipilaper.js";import{P as ue}from"./PageLoading-DYCMGmXg.js";import{C as je,a as me,b as W,c as y,d as ye,e as D}from"./CTable-iU6qPHck.js";import{c as Ce}from"./cil-zoom-CDkY_4k-.js";import{C as _e}from"./CPopover-B52llp3c.js";import{C as fe,a as X}from"./CPaginationItem-Dxu5LM3y.js";import{c as be}from"./cil-arrow-left-D66Kb3Zq.js";import{c as ve}from"./cil-arrow-right-CuetXaPY.js";import{C as ze}from"./CCard-Czglc9r9.js";import{C as we}from"./CCardHeader-CzZi6ULY.js";import{C as Ne}from"./CCardTitle-B-C91L6L.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-Dxe1bfDj.js";import"./CFormControlValidation-LxJhmD-X.js";import"./getRTLPlacement-Cwl9A_xm.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";const Se=({visible:j,onClose:p,item:h})=>e.jsxs(ee,{size:"xl",visible:j,onClose:p,backdrop:"static",children:[e.jsx(le,{children:e.jsxs(ae,{children:["Товар ( ",h==null?void 0:h.id," )"]})}),e.jsx(se,{children:e.jsxs(ie,{xs:{gutter:2},children:[e.jsx(P,{xs:{span:6},children:e.jsx(Z,{className:"p-2 m-0",color:"primary",children:"Имя"})}),e.jsx(P,{xs:{span:6},children:e.jsx(B,{children:e.jsx(V,{className:"p-2",children:h==null?void 0:h.title})})}),e.jsx(P,{xs:{span:6},children:e.jsx(Z,{className:"p-2 m-0",color:"primary",children:"Категория"})}),e.jsx(P,{xs:{span:6},children:e.jsx(B,{children:e.jsx(V,{className:"p-2",children:h==null?void 0:h.category_name})})}),e.jsx(P,{xs:{span:6},children:e.jsx(Z,{className:"p-2 m-0",color:"primary",children:"Цена"})}),e.jsx(P,{xs:{span:6},children:e.jsx(B,{children:e.jsx(V,{className:"p-2",children:h==null?void 0:h.price})})}),e.jsx(P,{xs:{span:6},children:e.jsx(Z,{className:"p-2 m-0",color:"primary",children:"Код товара"})}),e.jsx(P,{xs:{span:6},children:e.jsx(B,{children:e.jsx(V,{className:"p-2",children:h==null?void 0:h.code})})}),e.jsx(P,{xs:{span:6},children:e.jsx(Z,{className:"p-2 m-0",color:"primary",children:"Картинка"})}),e.jsx(P,{xs:{span:6},children:e.jsx(B,{children:e.jsx(V,{className:"p-2",children:e.jsx("img",{src:J+(h==null?void 0:h.img),alt:""})})})}),e.jsx(P,{xs:{span:6},children:e.jsx(Z,{className:"p-2 m-0",color:"primary",children:"Время"})}),e.jsx(P,{xs:{span:6},children:e.jsx(B,{children:e.jsx(V,{className:"p-2",children:h==null?void 0:h.created_at})})})]})})]}),Pe=({visible:j,onClose:p,id:h})=>{var d,o;const{edit:q,editLoading:H,detail:c,getDetail:s}=re(),{list:v,categoryParents:u}=ce();console.log("categories",v);const[a,_]=S.useState({title_ru:"",title_uz:"",code:"",category_id:"",price:"",money_type:"",img:null,description_ru:"",description_uz:"",characteristic:[{label:"Rang",value:""},{label:"Proba",value:""},{label:"Narxi",value:""},{label:"Razmer",value:""}],gallery:[""]}),[z,x]=S.useState({}),[w,I]=S.useState(!1),L=()=>{_({title_ru:"",title_uz:"",code:"",category_id:"",price:"",img:null,money_type:"",description_ru:"",description_uz:"",characteristic:[{label:"Rang",value:""},{label:"Proba",value:""},{label:"Narxi",value:""},{label:"Razmer",value:""}],gallery:[null]}),x({}),I(!1)},A=r=>{const{name:i,value:t}=r.target;_({...a,[i]:t})},T=(r,i)=>{const t=r.target.files[0];_({...a,[i]:t})},k=(r,i)=>{const t=[...a.characteristic];t[r].value=i,_({...a,characteristic:t})},U=()=>{_({...a,characteristic:[...a.characteristic,{label:"",value:""}]})},M=r=>{const i=a.characteristic.filter((t,m)=>m!==r);_({...a,characteristic:i})},l=(r,i)=>{const t=[...a.characteristic];t[r].label=i,_({...a,characteristic:t})},f=(r,i)=>{const t=[...a.gallery];t[r]=i,_({...a,gallery:t})},N=()=>{_({...a,gallery:[...a.gallery,null]})},G=r=>{const i=a.gallery.map((t,m)=>m===r?null:t);_({...a,gallery:i})};console.log(z),S.useEffect(()=>{j&&s(h)},[j]),S.useEffect(()=>{_({title_ru:c==null?void 0:c.title_ru,title_uz:c==null?void 0:c.title_uz,code:c==null?void 0:c.code,category_id:c==null?void 0:c.category_id,price:c==null?void 0:c.price,img:c==null?void 0:c.img,money_type:c==null?void 0:c.money_type,description_ru:c==null?void 0:c.description_ru,description_uz:c==null?void 0:c.description_uz,characteristic:(c==null?void 0:c.characteristic)||[],gallery:(c==null?void 0:c.gallery)||[]}),he(u,c==null?void 0:c.category_id,x)},[c]);const E=[{label:"Имя ( RU )",children:e.jsx(g,{name:"title_ru",value:a.title_ru,onChange:A,required:!0})},{label:"Имя ( UZ )",children:e.jsx(g,{name:"title_uz",value:a.title_uz,onChange:A})},{label:"Код товара",children:e.jsx(g,{name:"code",value:a.code,onChange:A})},{label:"Категория",children:e.jsx(F,{value:z==null?void 0:z.id,onChange:r=>{const i=u==null?void 0:u.find(t=>(t==null?void 0:t.id)==r.target.value);x(i||{}),_({...a,category_id:""})},required:!0,options:["",...u==null?void 0:u.map(r=>({label:r==null?void 0:r.title,value:r==null?void 0:r.id}))]})},{label:"Под категория",children:e.jsx(F,{name:"category_id",onChange:A,value:a==null?void 0:a.category_id,options:["",...(d=(z==null?void 0:z.subcategories)||[])==null?void 0:d.map(r=>({label:r==null?void 0:r.title,value:r==null?void 0:r.id}))]})},{label:"Цена",children:e.jsxs(e.Fragment,{children:[e.jsx(g,{name:"price",value:a.price,onChange:A}),e.jsx(oe,{children:e.jsxs(F,{size:"sm",name:"money_type",value:a.money_type,onChange:A,children:[e.jsx("option",{value:"usd",children:"USD"}),e.jsx("option",{value:"uzs",children:"UZS"})]})})]})},{label:"Основное изображение",children:e.jsxs("div",{children:[e.jsx(g,{type:"file",onChange:r=>T(r,"img")}),e.jsx("img",{src:J+(c==null?void 0:c.img),width:200,alt:""})]})},{label:"Фотогалерея",children:e.jsxs("div",{children:[Array.isArray(a==null?void 0:a.gallery)&&(a==null?void 0:a.gallery.map((r,i)=>e.jsxs("div",{className:"mt-2",children:[e.jsxs($,{children:[e.jsx(g,{type:"file",onChange:t=>f(i,t.target.files[0])}),e.jsx(C,{color:"danger",className:"ms-2",onClick:()=>G(i),children:e.jsx(R,{icon:K,style:{"--ci-primary-color":"white"}})})]}),e.jsx("img",{src:J+r,width:200,className:"mt-2",alt:""})]},i))),e.jsx(C,{color:"success",className:"mt-2 text-white",onClick:N,children:"Добавить фото"})]})},{label:"Характеристики",children:e.jsxs(e.Fragment,{children:[(o=a.characteristic)==null?void 0:o.map((r,i)=>e.jsx("div",{className:"mt-2 w-100",children:e.jsxs($,{children:[e.jsx(g,{placeholder:"Ключевое слово",value:r.label,onChange:t=>l(i,t.target.value),className:"me-2"}),e.jsx(g,{placeholder:"Значение",value:r.value,onChange:t=>k(i,t.target.value)}),e.jsx(C,{color:"danger",className:"ms-2",onClick:()=>M(i),children:e.jsx(R,{icon:K,style:{"--ci-primary-color":"white"}})})]})},i)),e.jsx(C,{color:"success",className:"mt-2 text-white",shape:"rounded",onClick:U,children:"Добавить характеристику"})]})},{label:"Описание ( RU )",children:e.jsx(O,{name:"description_ru",value:a.description_ru,onChange:A})},{label:"Описание ( UZ )",children:e.jsx(O,{name:"description_uz",value:a.description_uz,onChange:A})}],n=r=>{var t;if(r.preventDefault(),r.currentTarget.checkValidity()===!1)r.preventDefault(),r.stopPropagation();else{const m=new FormData;m.append("img",a.img),((t=a.gallery)==null?void 0:t.filter(b=>b&&typeof b!="string")).forEach((b,Q)=>{m.append("gallery",b)}),m.append("title_ru",a.title_ru),m.append("title_uz",a.title_uz),m.append("price",a.price||0),m.append("code",a.code||null),m.append("money_type",a.money_type),m.append("category_id",a!=null&&a.category_id?a==null?void 0:a.category_id:z==null?void 0:z.id),a.characteristic.forEach((b,Q)=>{b!=null&&b.value&&(m.append(`characteristic[${Q}][label]`,b.label),m.append(`characteristic[${Q}][value]`,b.value))}),m.append("description_ru",a.description_ru),m.append("description_uz",a.description_uz),q(h,m).then(b=>{(b==null?void 0:b.message)==="Updated successfully"&&(Y.success("Успешно отредактировано"),L(),p())}).catch(b=>console.log("err",b))}I(!0)};return e.jsxs(ee,{size:"xl",visible:j,onClose:p,backdrop:"static",children:[e.jsx(le,{children:e.jsx(ae,{children:"Редактировать товар"})}),e.jsx(se,{children:e.jsxs(te,{noValidate:!0,validated:w,onSubmit:n,children:[E==null?void 0:E.map((r,i)=>e.jsxs("div",{className:"mt-2",children:[e.jsx(de,{children:r.label}),e.jsx($,{children:r.children})]},i)),e.jsxs(ne,{children:[e.jsx(C,{color:"secondary",onClick:p,children:"Закрыть"}),e.jsx(C,{color:"primary",type:"submit",disabled:H,children:"Сохранить"})]})]})})]})},Ae=()=>{var M;const{getList:j,list:p,deleteLoading:h,remove:q,listLoading:H}=re(),{getList:c,list:s,getParents:v}=ce(),[u,a]=S.useState({}),[_,z]=S.useState(null),[x,w]=S.useState({page:1,pageSize:20,id:null,title:null,category_id:null,price:null,code:null,from_to:null}),[I,L]=S.useState(!1),[A,T]=S.useState(!1),k=(l,f)=>{w(N=>({...N,page:1,[l]:f||null}))},U=l=>{l.key==="Enter"&&j(x)};return S.useEffect(()=>{j(x),v()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(je,{striped:!0,children:[e.jsxs(me,{children:[e.jsxs(W,{children:[e.jsx(y,{scope:"col",children:"ИД"}),e.jsx(y,{scope:"col",children:"Имя"}),e.jsx(y,{scope:"col",children:"Категория"}),e.jsx(y,{scope:"col",children:"Цена"}),e.jsx(y,{scope:"col",children:"Код товара"}),e.jsx(y,{scope:"col",children:"Картинка"}),e.jsx(y,{scope:"col",children:"Время"}),e.jsx(y,{scope:"col"})]}),e.jsxs(W,{children:[e.jsx(y,{scope:"col",children:e.jsx(g,{type:"text",value:x==null?void 0:x.id,onChange:l=>k("id",l.target.value),onKeyPress:U})}),e.jsx(y,{scope:"col",children:e.jsx(g,{type:"text",value:x==null?void 0:x.title,onChange:l=>k("title",l.target.value),onKeyPress:U})}),e.jsx(y,{scope:"col",children:e.jsx(F,{name:"category_id",value:x==null?void 0:x.category_id,onChange:l=>{k("category_id",l.target.value),j({...x,page:1,category_id:l.target.value||null})},options:["",...s==null?void 0:s.map(l=>({label:l==null?void 0:l.title,value:l==null?void 0:l.id}))]})}),e.jsx(y,{scope:"col",children:e.jsx(g,{type:"text",onChange:l=>k("price",l.target.value),onKeyPress:U})}),e.jsx(y,{scope:"col",children:e.jsx(g,{type:"text",onChange:l=>k("code",l.target.value),onKeyPress:U})}),e.jsx(y,{scope:"col"}),e.jsx(y,{scope:"col",children:e.jsx(ge,{onDateSelected:(l,f)=>{const N=Math.floor(new Date(l).getTime()/1e3),G=Math.floor(new Date(f).getTime()/1e3);k("from_to",`${N}-${G}`)},onClose:()=>{x!=null&&x.from_to&&j({...x,page:1})}})}),e.jsx(y,{scope:"col"})]})]}),e.jsxs(ye,{children:[(M=p==null?void 0:p.data)==null?void 0:M.map((l,f)=>e.jsxs(W,{children:[e.jsx(y,{scope:"row",children:l==null?void 0:l.id}),e.jsx(D,{children:l==null?void 0:l.title}),e.jsx(D,{children:l==null?void 0:l.category_name}),e.jsx(D,{children:l==null?void 0:l.price}),e.jsx(D,{children:l==null?void 0:l.code}),e.jsx(D,{children:e.jsx(pe,{children:e.jsx("img",{style:{objectFit:"contain"},src:J+(l==null?void 0:l.img),width:50,height:50,alt:""})})}),e.jsx(D,{children:l==null?void 0:l.created_at}),e.jsx(D,{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(C,{color:"primary",onClick:()=>{a(l),L(!0)},children:e.jsx(R,{icon:Ce})}),e.jsx(_e,{title:l==null?void 0:l.id,trigger:"focus",content:e.jsxs("div",{children:[e.jsx("div",{children:"Вы точно хотите удалить?"}),e.jsx(C,{disabled:h,onClick:()=>q(l==null?void 0:l.id).then(N=>{N!=null&&N.data&&(Y.success("Успешно удалено"),j({page:1,pageSize:20}))}),color:"danger",className:"mt-2",children:"Удалить"})]}),children:e.jsx(C,{className:"mx-2",color:"danger",children:e.jsx(R,{icon:K})})}),e.jsx(C,{color:"warning",onClick:()=>{z(l==null?void 0:l.id),T(!0)},children:e.jsx(R,{icon:xe})})]})})]},f)),e.jsxs(fe,{children:[e.jsx(X,{onClick:()=>{const l={...x};l.page-=1,w(l),j(l)},disabled:x.page===1,children:e.jsx(R,{icon:be})}),[...Array(p==null?void 0:p.totalPages)].map((l,f)=>e.jsx(X,{onClick:()=>{const N={...x};N.page=f+1,w(N),j(N)},active:x.page===f+1,children:f+1},f)),e.jsx(X,{onClick:()=>{const l={...x};l.page+=1,w(l),j(l)},disabled:x.page===(p==null?void 0:p.totalPages),children:e.jsx(R,{icon:ve})})]})]})]})}),e.jsx(Se,{visible:I,onClose:()=>L(!1),item:u}),e.jsx(Pe,{visible:A,onClose:()=>T(!1),id:_}),e.jsx(ue,{loading:H})]})},ke=({visible:j,onClose:p})=>{var G,E;const{create:h,createLoading:q,getList:H}=re(),{categoryParents:c}=ce(),[s,v]=S.useState({title_ru:"",title_uz:"",code:"",category_id:"",price:"",money_type:"usd",img:null,description_ru:"",description_uz:"",characteristic:[{label:"Rang",value:""},{label:"Proba",value:""},{label:"Narxi",value:""},{label:"Razmer",value:""}],gallery:[""]}),[u,a]=S.useState({}),[_,z]=S.useState(!1),x=()=>{v({title_ru:"",title_uz:"",code:"",category_id:"",price:"",money_type:"usd",img:null,description_ru:"",description_uz:"",characteristic:[{label:"Rang",value:""},{label:"Proba",value:""},{label:"Narxi",value:""},{label:"Razmer",value:""}],gallery:[""]}),a({}),z(!1)},w=n=>{const{name:d,value:o}=n.target;v({...s,[d]:o})},I=(n,d)=>{const o=n.target.files[0];v({...s,[d]:o})},L=(n,d)=>{const o=[...s.characteristic];o[n].value=d,v({...s,characteristic:o})},A=()=>{v({...s,characteristic:[...s.characteristic,{label:"",value:""}]})},T=n=>{const d=s.characteristic.filter((o,r)=>r!==n);v({...s,characteristic:d})},k=(n,d)=>{const o=[...s.characteristic];o[n].label=d,v({...s,characteristic:o})},U=(n,d)=>{const o=[...s.gallery];o[n]=d,v({...s,gallery:o})},M=()=>{v({...s,gallery:[...s.gallery,null]})},l=n=>{const d=s.gallery.filter((o,r)=>r!==n);v({...s,gallery:d})},f=[{label:"Имя ( RU )",children:e.jsx(g,{name:"title_ru",value:s.title_ru,onChange:w,required:!0})},{label:"Имя ( UZ )",children:e.jsx(g,{name:"title_uz",value:s.title_uz,onChange:w})},{label:"Код товара",children:e.jsx(g,{name:"code",maxLength:6,value:s.code,onChange:w})},{label:"Категория",children:e.jsx(F,{value:u==null?void 0:u.id,onChange:n=>{n.target.value?a(c==null?void 0:c.find(d=>(d==null?void 0:d.id)==n.target.value)):(a({}),v({...s,category_id:""}))},required:!0,options:["",...c==null?void 0:c.map(n=>({label:n==null?void 0:n.title,value:n==null?void 0:n.id}))]})},{label:"Под категория",children:e.jsx(F,{name:"category_id",onChange:w,value:s==null?void 0:s.category_id,options:["",...(G=(u==null?void 0:u.subcategories)||[])==null?void 0:G.map(n=>({label:n==null?void 0:n.title,value:n==null?void 0:n.id}))]})},{label:"Цена",children:e.jsxs(e.Fragment,{children:[e.jsx(g,{name:"price",value:s.price,onChange:w}),e.jsx(oe,{children:e.jsxs(F,{size:"sm",name:"money_type",onChange:w,children:[e.jsx("option",{value:"usd",children:"USD"}),e.jsx("option",{value:"uzs",children:"UZS"})]})})]})},{label:"Основное изображение",children:e.jsx(g,{type:"file",onChange:n=>I(n,"img")})},{label:"Фотогалерея",children:e.jsxs("div",{children:[s==null?void 0:s.gallery.map((n,d)=>e.jsx("div",{className:"mt-2",children:e.jsxs($,{children:[e.jsx(g,{type:"file",onChange:o=>U(d,o.target.files[0])}),e.jsx(C,{color:"danger",className:"ms-2",onClick:()=>l(d),children:e.jsx(R,{icon:K,style:{"--ci-primary-color":"white"}})})]})},d)),e.jsx(C,{color:"success",className:"mt-2 text-white",onClick:M,children:"Добавить фото"})]})},{label:"Характеристики",children:e.jsxs(e.Fragment,{children:[(E=s.characteristic)==null?void 0:E.map((n,d)=>e.jsx("div",{className:"mt-2 w-100",children:e.jsxs($,{children:[e.jsx(g,{placeholder:"Ключевое слово",value:n.label,onChange:o=>k(d,o.target.value),className:"me-2"}),e.jsx(g,{placeholder:"Значение",value:n.value,onChange:o=>L(d,o.target.value)}),e.jsx(C,{color:"danger",className:"ms-2",onClick:()=>T(d),children:e.jsx(R,{icon:K,style:{"--ci-primary-color":"white"}})})]})},d)),e.jsx(C,{color:"success",className:"mt-2 text-white",shape:"rounded",onClick:A,children:"Добавить характеристику"})]})},{label:"Описание ( RU )",children:e.jsx(O,{name:"description_ru",value:s.description_ru,onChange:w})},{label:"Описание ( UZ )",children:e.jsx(O,{name:"description_uz",value:s.description_uz,onChange:w})}],N=n=>{if(n.preventDefault(),n.currentTarget.checkValidity()===!1)n.preventDefault(),n.stopPropagation();else{const o=new FormData;o.append("img",s.img),(Array.isArray(s.gallery)?s.gallery:[s.gallery]).forEach((i,t)=>{o.append("gallery",i)}),o.append("title_ru",s.title_ru),o.append("title_uz",s.title_uz),o.append("price",s.price||0),o.append("code",s.code||null),o.append("money_type",s.money_type),o.append("category_id",s!=null&&s.category_id?s==null?void 0:s.category_id:u==null?void 0:u.id),s.characteristic.forEach((i,t)=>{i!=null&&i.value&&(o.append(`characteristic[${t}][label]`,i.label),o.append(`characteristic[${t}][value]`,i.value))}),o.append("description_ru",s.description_ru),o.append("description_uz",s.description_uz),h(o).then(i=>{var t;(t=i==null?void 0:i.data)!=null&&t.id&&(Y.success("Успешно создано"),H({page:1,pageSize:20}),x(),p())}).catch(i=>console.log("err",i))}z(!0)};return e.jsxs(ee,{size:"xl",visible:j,onClose:p,backdrop:"static",children:[e.jsx(le,{children:e.jsx(ae,{children:"Создать товар"})}),e.jsx(se,{children:e.jsxs(te,{noValidate:!0,validated:_,onSubmit:N,children:[f==null?void 0:f.map((n,d)=>e.jsxs("div",{className:"mt-2",children:[e.jsx(de,{children:n.label}),e.jsx($,{children:n.children})]},d)),e.jsxs(ne,{children:[e.jsx(C,{color:"secondary",children:"Закрыть"}),e.jsx(C,{color:"primary",type:"submit",disabled:q,children:"Сохранить"})]})]})})]})},pl=()=>{const[j,p]=S.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(ze,{children:[e.jsx(we,{children:e.jsxs(ie,{children:[e.jsx(P,{className:"d-flex align-items-center",children:e.jsx(Ne,{className:"mb-0",children:"Продукты"})}),e.jsx(P,{className:"d-flex justify-content-end",children:e.jsx(C,{color:"primary",onClick:()=>p(!0),children:"Создать"})})]})}),e.jsx(Ae,{})]}),e.jsx(ke,{visible:j,onClose:()=>p(!1)})]})};export{pl as default};
